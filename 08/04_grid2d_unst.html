<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>grid2d_unst &mdash; iRIC-MI Documentation 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="grid2d_edge" href="05_grid2d_edge.html" />
    <link rel="prev" title="grid2d3d" href="03_grid_2d3d.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            iRIC-MI Documentation
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01_intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_install.html">How to Install iRIC-MI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_how_to_run.html">How to run models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_how_to_develop_models.html">How to develop models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_how_iricmi_works.html">How iRIC-MI works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_iricmilib_ref.html">iRIC-MI library Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../08_sample_models.html">Sample models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_global_send_receive.html"><code class="docutils literal notranslate"><span class="pre">global_send</span></code> and <code class="docutils literal notranslate"><span class="pre">global_receive</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="02_grid_att_send_receive.html"><code class="docutils literal notranslate"><span class="pre">grid_att_send</span></code> and <code class="docutils literal notranslate"><span class="pre">grid_att_receive</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="03_grid_2d3d.html"><code class="docutils literal notranslate"><span class="pre">grid2d3d</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#project-data">Project data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#result">Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="05_grid2d_edge.html"><code class="docutils literal notranslate"><span class="pre">grid2d_edge</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../09_iricmi_pymt_util.html">iricmi_pymt_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10_future_works.html">Future works</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">iRIC-MI Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../08_sample_models.html">Sample models</a></li>
      <li class="breadcrumb-item active"><code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/08/04_grid2d_unst.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="grid2d-unst">
<span id="sec-sample-model-grid2d-unst"></span><h1><code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code><a class="headerlink" href="#grid2d-unst" title="Permalink to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">grid_unst</span></code> is a model that reads two dimensional unstructured grid,
send values defined at grid nodes and cells.
It also receive values defined at grid nodes, cells.</p>
<p>Also it is possible to change the grid coordinates at every time step, by giving dx and dy values other than zero.</p>
<p>In the sample project, “st” is the project that runs <a class="reference internal" href="03_grid_2d3d.html#sec-sample-model-grid2d3d"><span class="std std-ref">grid2d3d</span></a>,
and “unst” is the project that runs <code class="docutils literal notranslate"><span class="pre">grid_unst</span></code>, and the values are exchanged
in both direction.</p>
<p><code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code> is implemented in FORTRAN, C++ and Python. On this page FORTRAN version is explained.</p>
<section id="id1">
<h2><code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code><a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p><a class="reference internal" href="#grid2d-unst-fortran-definition"><span class="std std-numref">Listing 39</span></a> shows “definition.xml” of <code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code>, and
<a class="reference internal" href="#grid2d-unst-fortran-main-f90"><span class="std std-numref">Listing 40</span></a> shows the source code of <code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code>.</p>
<p>The important points are as follows:</p>
<ul class="simple">
<li><p>In <a class="reference internal" href="03_grid_2d3d.html#grid2d3d-fortran-definition"><span class="std std-numref">Listing 36</span></a>, two &lt;GridType&gt; element is defined. The first one with name”input” is for two dimensional grid, and the other one with name “output3d” is for three dimensional grid. It is important that the for &lt;GridType&gt; with name “output3d”, attribute “post” is defined, and the value is “true”. It means that the grid should not be created in Pre-processing window, but generated inside the model, and used only for post-processing.</p></li>
<li><p>Output data is defined for both two dimensional grid and three dimensional grid. For two dimensional grid, the names are “outputNode2d”, “outputCell2d”, etc. For three dimensional grid, the names are “outputNode3d”, “outputCell3d”, etc.</p></li>
<li><p>Time dependent input data is defined for both two dimensional grid and three dimensional grid. For two dimensional grid, the names are “inputNode2d”, “inputCell2d”, etc. For three dimensional grid, the names are “inputNode3d”, “inputCell3d”, etc.</p></li>
<li><p>Line 95 of <a class="reference internal" href="03_grid_2d3d.html#grid2d3d-fortran-main-f90"><span class="std std-numref">Listing 37</span></a> calls <a class="reference internal" href="../07/refs/iRICMI_RIn_Grid3d_Coords_WithGridId.html#sec-ref-iricmi-rin-grid3d-coords-withgridid"><span class="std std-ref">iRICMI_RIn_Grid3d_Coords_WithGridId</span></a>, to output the grid. The three dimensional grid is saved to Case1.cgn, and also sent to <code class="docutils literal notranslate"><span class="pre">iricmi_server</span></code>. It is important that the value of the first argument is “output3d”, that matches the name of grid type defined in <a class="reference internal" href="03_grid_2d3d.html#grid2d3d-fortran-definition"><span class="std std-numref">Listing 36</span></a>.</p></li>
<li><p>Line 103 and 104 of <a class="reference internal" href="03_grid_2d3d.html#grid2d3d-fortran-main-f90"><span class="std std-numref">Listing 37</span></a> calls <a class="reference internal" href="../07/refs/iRICMI_ROut_Grid2d_Coords_WithGridId.html#sec-ref-iricmi-rout-grid2d-coords-withgridid"><span class="std std-ref">iRICMI_ROut_Grid2d_Coords_WithGridId</span></a> and <a class="reference internal" href="../07/refs/iRICMI_ROut_Grid3d_Coords_WithGridId.html#sec-ref-iricmi-rout-grid3d-coords-withgridid"><span class="std std-ref">iRICMI_ROut_Grid3d_Coords_WithGridId</span></a>. Calling these subroutines, the model passes the variables that stores the coordinates of the grid, and informs that the shape of the grids can change.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="grid2d-unst-fortran-definition">
<div class="code-block-caption"><span class="caption-number">Listing 39 </span><span class="caption-text">definition.xml of <code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code></span><a class="headerlink" href="#grid2d-unst-fortran-definition" title="Permalink to this code"></a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">&lt;SolverDefinition</span>
<span class="linenos"> 2</span><span class="w">	</span><span class="na">xmlns=</span><span class="s">&quot;www.iric.net/SolverDefinition/1.0&quot;</span>
<span class="linenos"> 3</span><span class="w">	</span><span class="na">name=</span><span class="s">&quot;grid2d_unst_fortran&quot;</span>
<span class="linenos"> 4</span><span class="w">	</span><span class="na">caption=</span><span class="s">&quot;Model for testing sending data for unstructured 2d grid (FORTRAN)&quot;</span>
<span class="linenos"> 5</span><span class="w">	</span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
<span class="linenos"> 6</span><span class="w">	</span><span class="na">copyright=</span><span class="s">&quot;iRIC organization&quot;</span>
<span class="linenos"> 7</span><span class="w">	</span><span class="na">release=</span><span class="s">&quot;2020.6.20&quot;</span>
<span class="linenos"> 8</span><span class="w">	</span><span class="na">homepage=</span><span class="s">&quot;http://i-ric.org&quot;</span>
<span class="linenos"> 9</span><span class="w">	</span><span class="na">executable=</span><span class="s">&quot;grid2d_unst_fortran.exe&quot;</span>
<span class="linenos">10</span><span class="w">	</span><span class="na">iterationtype=</span><span class="s">&quot;time&quot;</span>
<span class="linenos">11</span><span class="nt">&gt;</span>
<span class="linenos">12</span><span class="w">	</span><span class="nt">&lt;CalculationCondition&gt;</span>
<span class="linenos">13</span><span class="w">		</span><span class="nt">&lt;Tab</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;Basic&quot;</span><span class="nt">&gt;</span>
<span class="linenos">14</span><span class="w">			</span><span class="nt">&lt;Item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dx&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;Delta X&quot;</span><span class="nt">&gt;</span>
<span class="linenos">15</span><span class="w">				</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">default=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">16</span><span class="w">			</span><span class="nt">&lt;/Item&gt;</span>
<span class="linenos">17</span><span class="w">			</span><span class="nt">&lt;Item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dy&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;Delta Y&quot;</span><span class="nt">&gt;</span>
<span class="linenos">18</span><span class="w">				</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">default=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">19</span><span class="w">			</span><span class="nt">&lt;/Item&gt;</span>
<span class="linenos">20</span><span class="w">		</span><span class="nt">&lt;/Tab&gt;</span>
<span class="linenos">21</span><span class="w">	</span><span class="nt">&lt;/CalculationCondition&gt;</span>
<span class="linenos">22</span><span class="w">	</span><span class="nt">&lt;GridTypes&gt;</span>
<span class="linenos">23</span><span class="w">		</span><span class="nt">&lt;GridType</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;input&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;2D grid&quot;</span><span class="w"> </span><span class="na">gridtype=</span><span class="s">&quot;unstructured2d&quot;</span><span class="nt">&gt;</span>
<span class="linenos">24</span><span class="w">			</span><span class="nt">&lt;GridRelatedCondition&gt;</span>
<span class="linenos">25</span><span class="w">				</span><span class="nt">&lt;Item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Elevation&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;Elevation (m)&quot;</span><span class="nt">&gt;</span>
<span class="linenos">26</span><span class="w">					</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;node&quot;</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">default=</span><span class="s">&quot;max&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">27</span><span class="w">				</span><span class="nt">&lt;/Item&gt;</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="w">				</span><span class="nt">&lt;Item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inputNode2d&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;inputNode2d&quot;</span><span class="nt">&gt;</span>
<span class="linenos">30</span><span class="w">					</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;node&quot;</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">default=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
<span class="linenos">31</span><span class="w">						</span><span class="nt">&lt;Dimension</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Time&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;Time&quot;</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">32</span><span class="w">					</span><span class="nt">&lt;/Definition&gt;</span>
<span class="linenos">33</span><span class="w">				</span><span class="nt">&lt;/Item&gt;</span>
<span class="linenos">34</span><span class="w">				</span><span class="nt">&lt;Item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inputCell2d&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;inputCell2d&quot;</span><span class="nt">&gt;</span>
<span class="linenos">35</span><span class="w">					</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;cell&quot;</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">default=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
<span class="linenos">36</span><span class="w">						</span><span class="nt">&lt;Dimension</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Time&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;Time&quot;</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">37</span><span class="w">					</span><span class="nt">&lt;/Definition&gt;</span>
<span class="linenos">38</span><span class="w">				</span><span class="nt">&lt;/Item&gt;</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="w">				</span><span class="nt">&lt;Output</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outputNode2d&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;outputNode2d&quot;</span><span class="nt">&gt;</span>
<span class="linenos">41</span><span class="w">					</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;node&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">42</span><span class="w">				</span><span class="nt">&lt;/Output&gt;</span>
<span class="linenos">43</span><span class="w">				</span><span class="nt">&lt;Output</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outputCell2d&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;outputCell2d&quot;</span><span class="nt">&gt;</span>
<span class="linenos">44</span><span class="w">					</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;cell&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">45</span><span class="w">				</span><span class="nt">&lt;/Output&gt;</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="w">				</span><span class="nt">&lt;Output</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;receivedNode2d&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;receivedNode2d&quot;</span><span class="nt">&gt;</span>
<span class="linenos">48</span><span class="w">					</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;node&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">49</span><span class="w">				</span><span class="nt">&lt;/Output&gt;</span>
<span class="linenos">50</span><span class="w">				</span><span class="nt">&lt;Output</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;receivedCell2d&quot;</span><span class="w"> </span><span class="na">caption=</span><span class="s">&quot;receivedCell2d&quot;</span><span class="nt">&gt;</span>
<span class="linenos">51</span><span class="w">					</span><span class="nt">&lt;Definition</span><span class="w"> </span><span class="na">valueType=</span><span class="s">&quot;real&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;cell&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="linenos">52</span><span class="w">				</span><span class="nt">&lt;/Output&gt;</span>
<span class="linenos">53</span><span class="w">			</span><span class="nt">&lt;/GridRelatedCondition&gt;</span>
<span class="linenos">54</span><span class="w">		</span><span class="nt">&lt;/GridType&gt;</span>
<span class="linenos">55</span><span class="w">	</span><span class="nt">&lt;/GridTypes&gt;</span>
<span class="linenos">56</span><span class="nt">&lt;/SolverDefinition&gt;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="grid2d-unst-fortran-main-f90">
<div class="code-block-caption"><span class="caption-number">Listing 40 </span><span class="caption-text">source code main.f90 of <code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code></span><a class="headerlink" href="#grid2d-unst-fortran-main-f90" title="Permalink to this code"></a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="k">subroutine </span><span class="n">update_node_data</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span>
<span class="linenos">  2</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">t</span>
<span class="linenos">  3</span><span class="w">	</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">nodeCount</span>
<span class="linenos">  4</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">x</span>
<span class="linenos">  5</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">y</span>
<span class="linenos">  6</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="k">data</span>
<span class="linenos">  7</span><span class="k">	</span><span class="kt">integer</span><span class="kd">::</span><span class="w"> </span><span class="n">i</span>
<span class="linenos">  8</span><span class="w">	</span><span class="kt">double precision</span><span class="kd">::</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">v</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="w">	</span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nodeCount</span>
<span class="linenos"> 11</span><span class="w">		</span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos"> 12</span><span class="w">		</span><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos"> 13</span><span class="w">		</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">yy</span><span class="p">)</span>
<span class="linenos"> 14</span><span class="w">		</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="linenos"> 15</span><span class="w">		</span><span class="k">data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span>
<span class="linenos"> 16</span><span class="w">	</span><span class="k">end do</span>
<span class="linenos"> 17</span><span class="k">end subroutine</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="k">subroutine </span><span class="n">update_cell_data</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">cellCount</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">triangles</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span>
<span class="linenos"> 20</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">t</span>
<span class="linenos"> 21</span><span class="w">	</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">nodeCount</span>
<span class="linenos"> 22</span><span class="w">	</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">cellCount</span>
<span class="linenos"> 23</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">x</span>
<span class="linenos"> 24</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">y</span>
<span class="linenos"> 25</span><span class="w">	</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">cellCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">triangles</span>
<span class="linenos"> 26</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">cellCount</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="k">data</span>
<span class="linenos"> 27</span><span class="k">	</span><span class="kt">integer</span><span class="kd">::</span><span class="w"> </span><span class="n">i</span>
<span class="linenos"> 28</span><span class="w">	</span><span class="kt">double precision</span><span class="kd">::</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">v</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="w">	</span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">cellCount</span>
<span class="linenos"> 31</span><span class="w">		</span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="linenos"> 32</span><span class="w">		</span><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="linenos"> 33</span><span class="w">		</span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<span class="linenos"> 34</span><span class="w">			</span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">triangles</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="linenos"> 35</span><span class="w">			</span><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">triangles</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="linenos"> 36</span><span class="w">		</span><span class="k">end do</span>
<span class="linenos"> 37</span><span class="k">		</span><span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span>
<span class="linenos"> 38</span><span class="w">		</span><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yy</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="w">		</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">xx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">yy</span><span class="p">)</span>
<span class="linenos"> 41</span><span class="w">		</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
<span class="linenos"> 42</span><span class="w">		</span><span class="k">data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span>
<span class="linenos"> 43</span><span class="w">	</span><span class="k">end do</span>
<span class="linenos"> 44</span><span class="k">end subroutine</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span><span class="k">program </span><span class="n">grid2d_unst</span>
<span class="linenos"> 47</span><span class="w">	</span><span class="k">use </span><span class="n">iricmi</span>
<span class="linenos"> 48</span><span class="w">	</span><span class="k">implicit none</span>
<span class="linenos"> 49</span>
<span class="linenos"> 50</span><span class="k">	</span><span class="kt">integer</span><span class="kd">::</span><span class="w"> </span><span class="n">ier</span>
<span class="linenos"> 51</span><span class="w">	</span><span class="kt">integer</span><span class="kd">::</span><span class="w"> </span><span class="n">canceled</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span><span class="w">	</span><span class="kt">double precision</span><span class="kd">::</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span><span class="w">	</span><span class="kt">double precision</span><span class="kd">::</span><span class="w"> </span><span class="nb">time</span>
<span class="linenos"> 56</span><span class="nb">	</span><span class="kt">double precision</span><span class="kd">::</span><span class="w"> </span><span class="n">dt</span>
<span class="linenos"> 57</span><span class="w">	</span><span class="kt">double precision</span><span class="kd">::</span><span class="w"> </span><span class="n">endtime</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span><span class="w">	</span><span class="kt">integer</span><span class="kd">::</span><span class="w"> </span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">cellCount</span>
<span class="linenos"> 60</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="kd">::</span><span class="w"> </span><span class="n">gridX</span><span class="p">,</span><span class="w"> </span><span class="n">gridY</span>
<span class="linenos"> 61</span><span class="w">	</span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="kd">::</span><span class="w"> </span><span class="n">triangles</span>
<span class="linenos"> 62</span><span class="w">	</span>
<span class="linenos"> 63</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="kd">::</span><span class="w"> </span><span class="n">outputNode2d</span><span class="p">,</span><span class="w"> </span><span class="n">outputCell2d</span>
<span class="linenos"> 64</span><span class="w">	</span><span class="kt">double precision</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="kd">::</span><span class="w"> </span><span class="n">inputNode2d</span><span class="p">,</span><span class="w"> </span><span class="n">inputCell2d</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Model_Init</span><span class="p">(</span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span><span class="w">	</span><span class="nb">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="linenos"> 69</span><span class="w">	</span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="linenos"> 70</span><span class="w">	</span><span class="n">endtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span><span class="w">	</span><span class="c">! read grid</span>
<span class="linenos"> 73</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Read_Grid_NodeCount</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 74</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Read_Grid_CellCount</span><span class="p">(</span><span class="n">cellCount</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 75</span><span class="w">	</span><span class="k">allocate</span><span class="p">(</span><span class="n">gridX</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">),</span><span class="w"> </span><span class="n">gridY</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">))</span>
<span class="linenos"> 76</span><span class="w">	</span><span class="k">allocate</span><span class="p">(</span><span class="n">triangles</span><span class="p">(</span><span class="n">cellCount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="w">	</span><span class="k">allocate</span><span class="p">(</span><span class="n">outputNode2d</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">))</span>
<span class="linenos"> 79</span><span class="w">	</span><span class="k">allocate</span><span class="p">(</span><span class="n">outputCell2d</span><span class="p">(</span><span class="n">cellCount</span><span class="p">))</span>
<span class="linenos"> 80</span><span class="w">	</span><span class="k">allocate</span><span class="p">(</span><span class="n">inputNode2d</span><span class="p">(</span><span class="n">nodeCount</span><span class="p">))</span>
<span class="linenos"> 81</span><span class="w">	</span><span class="k">allocate</span><span class="p">(</span><span class="n">inputCell2d</span><span class="p">(</span><span class="n">cellCount</span><span class="p">))</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Read_Real</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 84</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Read_Real</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 85</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Read_Grid2d_Coords</span><span class="p">(</span><span class="n">gridX</span><span class="p">,</span><span class="w"> </span><span class="n">gridY</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 86</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Read_Grid_TriangleElements</span><span class="p">(</span><span class="n">triangles</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="w">	</span><span class="c">! register time</span>
<span class="linenos"> 89</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Time</span><span class="p">(</span><span class="nb">time</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 90</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Exchange_Interval</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 91</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Dump_Interval</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="w">	</span><span class="c">! register grid coords to output</span>
<span class="linenos"> 94</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Grid2d_Coords</span><span class="p">(</span><span class="n">gridX</span><span class="p">,</span><span class="w"> </span><span class="n">gridY</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span><span class="w">	</span><span class="c">! register grid attribute to output</span>
<span class="linenos"> 97</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Grid_Node_Real</span><span class="p">(</span><span class="s2">&quot;outputNode2d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">outputNode2d</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 98</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Grid_Cell_Real</span><span class="p">(</span><span class="s2">&quot;outputCell2d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">outputCell2d</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Grid_Node_Real</span><span class="p">(</span><span class="s2">&quot;receivedNode2d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">inputNode2d</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos">101</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_ROut_Grid_Cell_Real</span><span class="p">(</span><span class="s2">&quot;receivedCell2d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">inputCell2d</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos">102</span><span class="w">	</span>
<span class="linenos">103</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_RIn_Grid_Node_Real</span><span class="p">(</span><span class="s2">&quot;inputNode2d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">inputNode2d</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos">104</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_RIn_Grid_Cell_Real</span><span class="p">(</span><span class="s2">&quot;inputCell2d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">inputCell2d</span><span class="p">,</span><span class="w"> </span><span class="n">ier</span><span class="p">)</span>
<span class="linenos">105</span><span class="w">	</span>
<span class="linenos">106</span><span class="w">	</span><span class="k">call </span><span class="n">update_node_data</span><span class="p">(</span><span class="nb">time</span><span class="p">,</span><span class="w"> </span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">gridX</span><span class="p">,</span><span class="w"> </span><span class="n">gridY</span><span class="p">,</span><span class="w"> </span><span class="n">outputNode2d</span><span class="p">)</span>
<span class="linenos">107</span><span class="w">	</span><span class="k">call </span><span class="n">update_cell_data</span><span class="p">(</span><span class="nb">time</span><span class="p">,</span><span class="w"> </span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">cellCount</span><span class="p">,</span><span class="w"> </span><span class="n">gridX</span><span class="p">,</span><span class="w"> </span><span class="n">gridY</span><span class="p">,</span><span class="w"> </span><span class="n">triangles</span><span class="p">,</span><span class="w"> </span><span class="n">outputCell2d</span><span class="p">)</span>
<span class="linenos">108</span>
<span class="linenos">109</span><span class="w">	</span><span class="c">! first sync before entering time loop</span>
<span class="linenos">110</span><span class="w">	</span><span class="k">call </span><span class="n">iRICMI_Model_Sync</span><span class="p">(</span><span class="n">ier</span><span class="p">)</span>
<span class="linenos">111</span>
<span class="linenos">112</span><span class="w">	</span><span class="k">print</span><span class="w"> </span><span class="s2">&quot;(&#39;In grid2d_unst t = &#39;, f5.1)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">time</span>
<span class="linenos">113</span>
<span class="linenos">114</span><span class="nb">	</span><span class="k">do while</span><span class="w"> </span><span class="p">(.</span><span class="n">true</span><span class="p">.)</span>
<span class="linenos">115</span><span class="w">		</span><span class="nb">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span>
<span class="linenos">116</span>
<span class="linenos">117</span><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">endtime</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">118</span><span class="k">			exit</span>
<span class="linenos">119</span><span class="k">		end if</span>
<span class="linenos">120</span><span class="k">		</span>
<span class="linenos">121</span><span class="k">		call </span><span class="n">iRICMI_Check_Cancel</span><span class="p">(</span><span class="n">canceled</span><span class="p">)</span>
<span class="linenos">122</span><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canceled</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="linenos">123</span><span class="k">			exit</span>
<span class="linenos">124</span><span class="k">		end if</span>
<span class="linenos">125</span>
<span class="linenos">126</span><span class="k">		</span><span class="n">gridX</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gridX</span><span class="p">(:)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dx</span>
<span class="linenos">127</span><span class="w">		</span><span class="n">gridY</span><span class="p">(:)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gridY</span><span class="p">(:)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dy</span>
<span class="linenos">128</span>
<span class="linenos">129</span><span class="w">		</span><span class="k">call </span><span class="n">update_node_data</span><span class="p">(</span><span class="nb">time</span><span class="p">,</span><span class="w"> </span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">gridX</span><span class="p">,</span><span class="w"> </span><span class="n">gridY</span><span class="p">,</span><span class="w"> </span><span class="n">outputNode2d</span><span class="p">)</span>
<span class="linenos">130</span><span class="w">		</span><span class="k">call </span><span class="n">update_cell_data</span><span class="p">(</span><span class="nb">time</span><span class="p">,</span><span class="w"> </span><span class="n">nodeCount</span><span class="p">,</span><span class="w"> </span><span class="n">cellCount</span><span class="p">,</span><span class="w"> </span><span class="n">gridX</span><span class="p">,</span><span class="w"> </span><span class="n">gridY</span><span class="p">,</span><span class="w"> </span><span class="n">triangles</span><span class="p">,</span><span class="w"> </span><span class="n">outputCell2d</span><span class="p">)</span>
<span class="linenos">131</span>
<span class="linenos">132</span><span class="w">		</span><span class="k">call </span><span class="n">iRICMI_Model_Sync</span><span class="p">(</span><span class="n">ier</span><span class="p">)</span>
<span class="linenos">133</span>
<span class="linenos">134</span><span class="w">		</span><span class="k">print</span><span class="w"> </span><span class="s2">&quot;(&#39;In grid2d_unst t = &#39;, f5.1)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">time</span>
<span class="linenos">135</span><span class="nb">	</span><span class="k">end do</span>
<span class="linenos">136</span>
<span class="linenos">137</span><span class="k">	call </span><span class="n">iRICMI_Model_Terminate</span><span class="p">(</span><span class="n">ier</span><span class="p">)</span>
<span class="linenos">138</span><span class="w">	</span><span class="k">stop</span>
<span class="linenos">139</span><span class="k">end program</span>
</pre></div>
</div>
</div>
</section>
<section id="project-data">
<h2>Project data<a class="headerlink" href="#project-data" title="Permalink to this heading"></a></h2>
<p>The project data to run <code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code> and <code class="docutils literal notranslate"><span class="pre">grid2d3d</span></code> is stored in testdata/grid2d_unst_fortran folder.</p>
<p><a class="reference internal" href="#grid2d-unst-fortran-iricmi-project"><span class="std std-numref">Listing 41</span></a> shows iricmi_project.xml. You can see that
connections are defined to exchange data between two regions.</p>
<p><a class="reference internal" href="#image-grid2d-unst-st-input"><span class="std std-numref">Fig. 24</span></a> and <a class="reference internal" href="#image-grid2d-unst-unst-input"><span class="std std-numref">Fig. 25</span></a> shows the shape of grids defined for “st” and “unst”.
The gray area in <a class="reference internal" href="#image-grid2d-unst-unst-input"><span class="std std-numref">Fig. 25</span></a> corresponds to the grid region of “st”, so the grid of “unst” is inside that of “st”.</p>
<p>For “unst”, dx = 0.01, dy = -0.02. It means that for “unst” the region of the grids slide every time step.</p>
<p>As explained in <a class="reference internal" href="../03/01_overview.html#sec-how-to-run-coupled"><span class="std std-ref">Running models in “coupled” mode</span></a>, you can run the models for the project, by “chdir”ing to the
project folder, and launch <code class="docutils literal notranslate"><span class="pre">iricmi_run</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="grid2d-unst-fortran-iricmi-project">
<div class="code-block-caption"><span class="caption-number">Listing 41 </span><span class="caption-text">iricmi_project.xml for <code class="docutils literal notranslate"><span class="pre">grid2d_unst</span></code> and <code class="docutils literal notranslate"><span class="pre">grid2d3d</span></code></span><a class="headerlink" href="#grid2d-unst-fortran-iricmi-project" title="Permalink to this code"></a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="linenos"> 2</span><span class="nt">&lt;iRICMIProject&gt;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">&lt;Models&gt;</span>
<span class="linenos"> 4</span><span class="w">        </span><span class="nt">&lt;Model</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;st&quot;</span><span class="w"> </span><span class="na">nodes=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="linenos"> 5</span><span class="w">        </span><span class="nt">&lt;Model</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;unst&quot;</span><span class="w"> </span><span class="na">nodes=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">&lt;/Models&gt;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">&lt;Connections&gt;</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">&lt;Connection&gt;</span>
<span class="linenos"> 9</span><span class="w">            </span><span class="nt">&lt;From</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;st&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">gridName=</span><span class="s">&quot;input&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outputNode2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">10</span><span class="w">            </span><span class="nt">&lt;To</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;unst&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">gridName=</span><span class="s">&quot;input&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inputNode2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">11</span><span class="w">        </span><span class="nt">&lt;/Connection&gt;</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">&lt;Connection&gt;</span>
<span class="linenos">13</span><span class="w">            </span><span class="nt">&lt;From</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;st&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">gridName=</span><span class="s">&quot;input&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outputCell2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">14</span><span class="w">            </span><span class="nt">&lt;To</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;unst&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">gridName=</span><span class="s">&quot;input&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inputCell2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">15</span><span class="w">        </span><span class="nt">&lt;/Connection&gt;</span>
<span class="linenos">16</span><span class="w">        </span><span class="nt">&lt;Connection&gt;</span>
<span class="linenos">17</span><span class="w">            </span><span class="nt">&lt;From</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;unst&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outputNode2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">18</span><span class="w">            </span><span class="nt">&lt;To</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;st&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">gridName=</span><span class="s">&quot;input&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inputNode2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">19</span><span class="w">        </span><span class="nt">&lt;/Connection&gt;</span>
<span class="linenos">20</span><span class="w">        </span><span class="nt">&lt;Connection&gt;</span>
<span class="linenos">21</span><span class="w">            </span><span class="nt">&lt;From</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;unst&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outputCell2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">22</span><span class="w">            </span><span class="nt">&lt;To</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;st&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gridAttribute&quot;</span><span class="w"> </span><span class="na">gridName=</span><span class="s">&quot;input&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inputCell2d&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">23</span><span class="w">        </span><span class="nt">&lt;/Connection&gt;</span>
<span class="linenos">24</span><span class="w">    </span><span class="nt">&lt;/Connections&gt;</span>
<span class="linenos">25</span><span class="nt">&lt;/iRICMIProject&gt;</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="id2">
<span id="image-grid2d-unst-st-input"></span><img alt="../_images/grid2d_unst_st_input.png" src="../_images/grid2d_unst_st_input.png" />
<figcaption>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">The grid defined for “st”</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id3">
<span id="image-grid2d-unst-unst-input"></span><img alt="../_images/grid2d_unst_unst_input.png" src="../_images/grid2d_unst_unst_input.png" />
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">The grid defined for “unst”</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="result">
<h2>Result<a class="headerlink" href="#result" title="Permalink to this heading"></a></h2>
<p>The screenshots to visualize the calculation result are shown from
<a class="reference internal" href="#image-grid2d-unst-st-output1"><span class="std std-numref">Fig. 26</span></a> to <a class="reference internal" href="#image-grid2d-unst-unst-received100"><span class="std std-numref">Fig. 33</span></a>.</p>
<p>From the screenshots, we can check the followings:
* Mapping grid atribute values works for structured grid and unstructured grid.
* When the grid coordinates are changed for each time step, it is applied to mapping result.</p>
<figure class="align-default" id="id4">
<span id="image-grid2d-unst-st-output1"></span><img alt="../_images/grid2d_unst_st_output1.png" src="../_images/grid2d_unst_st_output1.png" />
<figcaption>
<p><span class="caption-number">Fig. 26 </span><span class="caption-text">outputNode2d of “st” (t = 0)</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id5">
<span id="image-grid2d-unst-st-output100"></span><img alt="../_images/grid2d_unst_st_output100.png" src="../_images/grid2d_unst_st_output100.png" />
<figcaption>
<p><span class="caption-number">Fig. 27 </span><span class="caption-text">outputNode2d of “st” (t = 100)</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id6">
<span id="image-grid2d-unst-st-received1"></span><img alt="../_images/grid2d_unst_st_received1.png" src="../_images/grid2d_unst_st_received1.png" />
<figcaption>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">receivedNode2d of “st” (t = 0)</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id7">
<span id="image-grid2d-unst-st-received100"></span><img alt="../_images/grid2d_unst_st_received100.png" src="../_images/grid2d_unst_st_received100.png" />
<figcaption>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text">receivedNode2d of “st” (t = 100)</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id8">
<span id="image-grid2d-unst-unst-output1"></span><img alt="../_images/grid2d_unst_unst_output1.png" src="../_images/grid2d_unst_unst_output1.png" />
<figcaption>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">outputNode2d of “unst” (t = 0)</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id9">
<span id="image-grid2d-unst-unst-output100"></span><img alt="../_images/grid2d_unst_unst_output100.png" src="../_images/grid2d_unst_unst_output100.png" />
<figcaption>
<p><span class="caption-number">Fig. 31 </span><span class="caption-text">outputNode2d of “unst” (t = 100)</span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id10">
<span id="image-grid2d-unst-unst-received1"></span><img alt="../_images/grid2d_unst_unst_received1.png" src="../_images/grid2d_unst_unst_received1.png" />
<figcaption>
<p><span class="caption-number">Fig. 32 </span><span class="caption-text">receivedNode2d of “unst” (t = 0)</span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id11">
<span id="image-grid2d-unst-unst-received100"></span><img alt="../_images/grid2d_unst_unst_received100.png" src="../_images/grid2d_unst_unst_received100.png" />
<figcaption>
<p><span class="caption-number">Fig. 33 </span><span class="caption-text">receivedNode2d of “unst” (t = 100)</span><a class="headerlink" href="#id11" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="03_grid_2d3d.html" class="btn btn-neutral float-left" title="grid2d3d" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="05_grid2d_edge.html" class="btn btn-neutral float-right" title="grid2d_edge" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, iRIC organization.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>